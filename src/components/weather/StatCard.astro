---
// ==========================================
// COMPONENTE: TARJETA PRINCIPAL (ESTADÍSTICAS)
// ==========================================
// Muestra el resumen del clima actual:
// - Tarjeta grande con Temperatura, Ciudad e Ícono.
// - 4 Tarjetas pequeñas con métricas (Sensación térmica, Humedad, Viento, Precipitación).

import WeatherIcon from "../weather/ui_HourlyForestcast/WeatherIcon.astro";
import { getStackCardData } from "../../services/weatherUtils.ts";

// 1. RECEPCIÓN DE DATOS POR PROPS
const { weatherData } = Astro.props;

// 2. GUARDIA DE SEGURIDAD
if (!weatherData) {
    return null;
}

// 3. TRANSFORMACIÓN DE DATOS
const info = getStackCardData(
    weatherData.weather,
    weatherData.geo,
    weatherData.units,
);
---

<section
    class="max-w-[450px] mx-auto p-2 flex justify-center items-center md:max-w-2xl lg:min-w-full lg:mx-0"
>
    {/* GRID PRINCIPAL: 2 columnas en mobile, 4 en desktop */}
    <div
        class="grid grid-cols-2 grid-rows-8 h-[500px] w-[450px] gap-4 lg:grid-cols-4 lg:grid-rows-6 lg:min-w-full lg:h-[400px]"
    >
        {/* === 1. TARJETA CLIMA ACTUAL (MAIN CARD) === */}
        <div
            class="col-span-2 row-span-4 lg:flex lg:flex-row lg:items-center lg:justify-between lg:col-span-4 lg:row-span-4 theme-card bg-[url('/images/bg-today-small.svg')] lg:bg-[url('/images/bg-today-large.svg')] bg-cover bg-center bg-no-repeat p-5 flex flex-col justify-between relative overflow-hidden group"
        >
            <div class="absolute inset-0 bg-black/10 z-0"></div>

            <div
                class="z-10 flex flex-col items-center lg:items-start lg:text-start"
            >
                <h2
                    class="font-bold text-white font-DMSans text-center text-2xl drop-shadow-md lg:text-start"
                >
                    {info.city}, <span class="text-white/90 lg:text-start"
                        >{info.country}</span
                    >
                </h2>
                <p
                    class="text-white/80 text-sm mt-1 font-DMSans font-semibold capitalize text-center drop-shadow-sm"
                >
                    {info.date}
                </p>
            </div>

            <div
                class="flex items-center justify-between z-10 mt-2 px-2 lg:gap-10"
            >
                {/* ÍCONO DEL CLIMA */}
                <div class="w-32 h-32 lg:w-28 lg:h-28">
                    <WeatherIcon
                        code={info.code}
                        class="w-full h-full drop-shadow-2xl filter"
                    />
                </div>

                {/* TEMPERATURA */}
                <div class="flex flex-col items-end">
                    <div class="flex items-start">
                        <span
                            class="text-8xl font-DMSans font-bold text-white tracking-tighter drop-shadow-lg"
                        >
                            {info.temp}
                        </span>
                        <span
                            class="text-4xl font-DMSans font-bold text-white/80 mt-4 ml-1"
                        >
                            {info.tempUnit}
                        </span>
                    </div>
                </div>
            </div>
        </div>

        {/* === 2. TARJETAS PEQUEÑAS (GRIDS) === */}

        {/* FEELS LIKE */}
        <div
            class="row-span-2 row-start-5 theme-card lg:col-span-1 lg:row-span-2 theme-card-info-main"
        >
            <span class="theme-card-info-sub">Feels like</span>
            <span class="text-2xl font-DMSans text-white">
                {info.feelsLike}{info.tempUnit}
            </span>
        </div>

        {/* HUMIDITY */}
        <div
            class="row-span-2 row-start-5 theme-card lg:col-span-1 lg:row-span-2 theme-card-info-main"
        >
            <span class="theme-card-info-sub">Humidity</span>
            <span class="text-2xl font-DMSans text-white">
                {info.humidity}%
            </span>
        </div>

        {/* WIND */}
        <div
            class="row-span-2 row-start-7 theme-card lg:col-span-1 lg:row-span-2 theme-card-info-main"
        >
            <span class="theme-card-info-sub">Wind</span>
            <div class="flex items-baseline gap-1">
                <span class="text-2xl font-DMSans text-white">
                    {info.wind}
                </span>
                <span class="text-sm text-white/60 font-medium">
                    {info.windUnit}
                </span>
            </div>
        </div>

        {/* PRECIPITATION */}
        <div
            class="row-span-2 row-start-7 theme-card lg:col-span-1 lg:row-span-2 theme-card-info-main"
        >
            <span class="theme-card-info-sub">Precipitation</span>
            <div class="flex items-baseline gap-1">
                <span class="text-2xl font-DMSans text-white">
                    {info.precip}
                </span>
                <span class="text-sm text-white/60 font-medium">
                    {info.precipUnit}
                </span>
            </div>
        </div>
    </div>
</section>
