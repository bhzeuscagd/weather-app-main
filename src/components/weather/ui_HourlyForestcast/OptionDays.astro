---
import Icon from "../../ui/Icon.astro";

interface Props {
    days: string[];
    selectedDay: string;
}

const { days, selectedDay } = Astro.props;

const formatDate = (dateStr: string) => {
    const date = new Date(dateStr + "T00:00:00");
    return date.toLocaleDateString("es-ES", { weekday: "long" });
};

const selectedLabel = formatDate(selectedDay);
---

<div class="relative inline-block text-left z-50 group">
    <button
        class="font-DMSans inline-flex w-full justify-center items-center gap-2 rounded-md bg-white/10 px-2 py-1 text-sm text-white inset-ring-1 inset-ring-white/5 hover:bg-white/20 hover:border-black hover:border-solid hover:border-2 hover:ring-2 hover:ring-white capitalize"
    >
        <span>{selectedLabel}</span>
        <Icon name="dropdown" class="w-2.5 h-5 text-white" />
    </button>

    <menu
        class="absolute right-0 top-full mt-2 group-hover:block hidden group-focus-within:block w-48 origin-top-right divide-y divide-white/10 rounded-md bg-[#13131A] outline-1 border border-white/30 transition transition-discrete backdrop-blur-md shadow-sm shadow-white/20"
    >
        <div class="p-1 flex flex-col gap-1">
            {
                days.map((day) => {
                    const label = formatDate(day);
                    const isActive = day === selectedDay;

                    return (
                        <button
                            class:list={[
                                "text-left px-3 py-2 text-sm rounded-md capitalize w-full transition-colors flex justify-between items-center",
                                isActive
                                    ? "bg-white/20 text-white font-bold"
                                    : "text-gray-300 hover:bg-white/10 hover:text-white",
                            ]}
                            data-date={day}
                            onclick="updateDate(this)"
                        >
                            {label}
                            {isActive && (
                                <Icon name="check" class="w-3 h-3 text-white" />
                            )}
                        </button>
                    );
                })
            }
        </div>
    </menu>
</div>

<script is:inline>
    function updateDate(button) {
        const newDate = button.getAttribute("data-date");
        const url = new URL(window.location.href);
        url.searchParams.set("date", newDate);
        window.location.href = url.toString();
    }
</script>
