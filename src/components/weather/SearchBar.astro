---
// ==========================================
// COMPONENTE: BARRA DE BÚSQUEDA
// ==========================================
// - Input de texto para buscar ciudades.
// - Lista de sugerencias (dropdown).
// - Botón de búsqueda.
// - Integra lógica cliente (JS) para autocompletado y redirección.

import Icon from "../ui/Icon.astro";
import Button from "../ui/Button.astro";
---

<div
    class="flex flex-col gap-2 py-8 relative z-50 lg:max-w-[800px] lg:flex-row lg:items-center lg:gap-4 lg:my-0 lg:mx-auto"
>
    {/* CONTENEDOR INPUT + ICONO */}
    <div class="flex items-center gap-2 relative w-full text-white">
        <input
            id="search-input"
            type="text"
            autocomplete="off"
            placeholder="Search for a place..."
            class="w-full p-2 pl-10 theme-card peer transition-all focus:pl-2 outline-none text-white placeholder-white/50"
        />

        {/* Lupa (Decorativa) */}
        <Icon
            name="search"
            class="absolute text-white left-4 top-1/2 -translate-y-1/2 transition-all peer-focus:opacity-0 peer-focus:scale-75 pointer-events-none"
        />

        {/* LISTA DE SUGERENCIAS (Oculta por defecto, se llena con JS) */}
        <ul
            id="suggestions-list"
            class="absolute top-full inset-x-2 mt-2 bg-neutral-800 border border-white/10 rounded-xl shadow-2xl overflow-hidden hidden max-h-60 overflow-y-auto z-50"
        >
        </ul>
    </div>

    {/* BOTÓN SEARCH */}
    <div id="search-btn-wrapper" class="w-full lg:w-auto">
        <Button>Search</Button>
    </div>
</div>

<script>
    // ==========================================
    // LÓGICA DE CLIENTE (Hidratación)
    // ==========================================
    // Importamos la lógica encapsulada en SearchLogic.ts
    // Se encarga de: listeners de input, fetch de sugerencias, navegación al hacer click.

    import { initSearch } from "../../scripts/SearchLogic.ts";

    // Inicialización cuando el componente se monta en el cliente
    initSearch();

    // IMPORTANTE: Con View Transitions, necesitamos reinicializar después de cada navegación
    document.addEventListener("astro:page-load", () => {
        // Removemos el estado de búsqueda
        document.body.classList.remove("is-searching");

        // Reinicializamos la búsqueda
        initSearch();
    });
</script>
